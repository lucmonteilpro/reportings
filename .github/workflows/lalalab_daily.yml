name: Lalalab Daily Pipeline

on:
  schedule:
    # Tous les jours Ã  3h00 heure Paris (2h00 UTC)
    - cron: '0 2 * * *'
  workflow_dispatch: # Permet lancement manuel pour tester

jobs:
  lalalab-pipeline:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v3
    
    - name: ðŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: ðŸ“¦ Install dependencies
      run: |
        pip install pandas requests gspread gspread-dataframe google-auth google-auth-oauthlib google-auth-httplib2
    
    - name: ðŸ”‘ Setup Google credentials
      run: |
        echo '${{ secrets.GOOGLE_SERVICE_ACCOUNT }}' > service_account.json
    
    - name: ðŸ“Š Push donnÃ©es de la veille
      run: |
        python3 adjust_lalalab_simple.py
      env:
        TZ: 'Europe/Paris'
    
    - name: ðŸ’° Update revenues 30 derniers jours
      run: |
        python3 adjust_lalalab_simple.py --update-revenues
      env:
        TZ: 'Europe/Paris'
    
    - name: ðŸ§¹ Cleanup
      if: always()
      run: rm -f service_account.json
